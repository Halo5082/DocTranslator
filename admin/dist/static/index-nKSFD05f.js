import{r as S,f as F,_ as q}from"./index-CtSaNRC4.js";import{s as J,r as Z,t as G,v as H,w as B,E as h}from"./element-BJhk1yyC.js";import{u as K}from"./usePagination-DRno2DY3.js";import{l as Q,r as k,Z as W,b as X,ah as s,ap as Y,m as u,p as ee,P as te,M as g,O as t,U as e,u as o,S as i,q as P,R as ae}from"./vue-DSQ7aDT9.js";import"./vxe-Cuv8YH4T.js";function ne(p){return S({url:"translates",method:"get",params:p})}function oe(p){return S({url:`/translate/${p}`,method:"delete"})}function le(p){return S({url:"/translates/delete/batch",method:"post",data:p})}const re={class:"app-container"},se={class:"table-wrapper"},ie={class:"pager-wrapper"},ce=Q({name:"Translate",__name:"index",setup(p){const D="/api",v=k(!1),{paginationData:a,handleCurrentChange:R,handleSizeChange:E}=K(),U=n=>{B.confirm("确认删除当前文档吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{oe(n.id).then(()=>{h.success("删除成功"),y()})})},f=k([]),V=n=>{f.value=n.map(_=>_.id),f.value},M=()=>{if(f.value.length===0){h.warning("请选择要删除的文档");return}B.confirm("正在批量删除选中文档，确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{le({ids:f.value}).then(()=>{h.success("删除成功"),y()})})},N=()=>{if(f.value.length===0){h.warning("请选择要下载的文档");return}const n=f.value,_=`${D}/api/admin/translates/download/batch`,C=F();fetch(_,{method:"POST",headers:{"Content-Type":"application/json",token:C},body:JSON.stringify({ids:n})}).then(d=>{if(!d.ok)throw new Error("Network response was not ok");return d.blob()}).then(d=>{const x=`downloads_${new Date().toISOString().split("T")[0]}.zip`,l=window.URL.createObjectURL(d),r=document.createElement("a");r.href=l,r.download=x,document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(l)}).catch(d=>{h.error("下载失败，请稍后重试")})},b=k([]),T=k(null),w=W({keyword:""}),y=()=>{v.value=!0,ne({page:a.currentPage,limit:a.pageSize,keyword:w.keyword||void 0}).then(({data:n})=>{a.total=n.total,b.value=n.data}).catch(()=>{b.value=[]}).finally(()=>{v.value=!1})},z=()=>{a.currentPage===1?y():a.currentPage=1},O=()=>{var n;(n=T.value)==null||n.resetFields(),z()};return X([()=>a.currentPage,()=>a.pageSize],y,{immediate:!0}),(n,_)=>{const C=s("el-input"),d=s("el-form-item"),m=s("el-button"),x=s("el-form"),l=s("el-table-column"),r=s("el-tag"),L=s("el-link"),A=s("el-table"),I=s("el-pagination"),$=s("el-card"),j=Y("loading");return u(),ee("div",re,[te((u(),g($,{shadow:"never"},{default:t(()=>[e(x,{ref_key:"searchFormRef",ref:T,inline:!0,model:w},{default:t(()=>[e(d,{prop:"keyword",label:"",style:{width:"320px","max-width":"100%"}},{default:t(()=>[e(C,{modelValue:w.keyword,"onUpdate:modelValue":_[0]||(_[0]=c=>w.keyword=c),placeholder:"输入查询"},null,8,["modelValue"])]),_:1}),e(d,null,{default:t(()=>[e(m,{type:"primary",icon:o(J),onClick:z},{default:t(()=>[i("查询")]),_:1},8,["icon"]),e(m,{icon:o(Z),onClick:O},{default:t(()=>[i("重置")]),_:1},8,["icon"]),e(m,{icon:o(G),onClick:M},{default:t(()=>[i("删除")]),_:1},8,["icon"]),e(m,{icon:o(H),onClick:N},{default:t(()=>[i("下载")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),P("div",se,[e(A,{data:b.value,onSelectionChange:V},{default:t(()=>[e(l,{type:"selection",width:"50",align:"left"}),e(l,{prop:"customer_no",label:"所属用户ID",align:"left"}),e(l,{prop:"origin_filename",label:"文档名称",align:"left"}),e(l,{prop:"status",label:"任务状态",align:"left"},{default:t(c=>[c.row.status=="none"?(u(),g(r,{key:0,type:"primary",effect:"plain"},{default:t(()=>[i("未完成")]),_:1})):c.row.status=="process"?(u(),g(r,{key:1,type:"warning",effect:"plain"},{default:t(()=>[i("翻译中")]),_:1})):c.row.status=="failed"?(u(),g(r,{key:2,type:"danger",effect:"plain"},{default:t(()=>[i("翻译失败")]),_:1})):(u(),g(r,{key:3,type:"success",effect:"plain"},{default:t(()=>[i("已完成")]),_:1}))]),_:1}),e(l,{prop:"start_at",label:"任务开始时间",align:"left"}),e(l,{prop:"spend_time",label:"完成用时",align:"left"}),e(l,{fixed:"right",label:"操作",width:"100",align:"left"},{default:t(c=>[c.row.target_filepath?(u(),g(L,{key:0,style:{color:"#409eff","margin-right":"12px"},href:o(D)+"/api/admin/translate/download/"+c.row.id},{default:t(()=>[i("下载")]),_:2},1032,["href"])):ae("",!0),e(m,{type:"danger",text:"",size:"small",onClick:de=>U(c.row)},{default:t(()=>[i("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),P("div",ie,[e(I,{background:"",layout:o(a).layout,"page-sizes":o(a).pageSizes,total:o(a).total,"page-size":o(a).pageSize,currentPage:o(a).currentPage,onSizeChange:o(E),onCurrentChange:o(R)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[j,v.value]])])}}}),ge=q(ce,[["__scopeId","data-v-dd566caf"]]);export{ge as default};
